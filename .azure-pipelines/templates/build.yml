parameters:
  - name: dockerImage
    type: string
  - name: jarName
    type: string
  - name: platform
    type: string

jobs:
  - job: Build
    displayName: Build with Docker
    steps:
      - script: |
          ls -l app/
        displayName: 'List app directory'
      - script: |
          docker run --rm \
            --platform ${{ parameters.platform }} \
            -v $(pwd)/app:/app \
            ${{ parameters.dockerImage }} \
            /bin/bash -c "cd /app && ./mvnw clean package -DskipTests"
        displayName: 'Build JAR with Docker'
      - script: |
          ls -lh app/target/
        displayName: 'List build artifacts'
      - script: |
          echo "##vso[task.setvariable variable=JAR_PATH]$(pwd)/app/target/${{ parameters.jarName }}"
        displayName: 'Set JAR path variable'